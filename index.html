<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendar Ledger</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJzaG9ydF9uYW1lIjogIkxlZGdlciIsCiAgIm5hbWUiOiAiQ2FsZW5kYXIgTGVkZ2VyIiwKICAiZGVzY3JpcHRpb24iOiAiQSBjYWxlbmRhci1iYXNlZCBjYWxjdWxhdG9yIHRvIHRyYWNrIGRhaWx5IGZpbmFuY2lhbCBlbnRyaWVzLiBBZGQgb3Igc3VidHJhY3QgbnVtYmVycyBmb3IgZWFjaCBkYXkgb2YgdGhlIG1vbnRoIGFuZCBzZWUgYSBydW5uaW5nIHRvdGFsLiBZb3VyIGRhdGEgaXMgc2F2ZWQgbG9jYWxseSBpbiB5b3VyIGJyb3dzZXIuIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiaWNvbi0xOTIucG5nIiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciLAogICAgICAicHVycG9zZSI6ICJhbnkgbWFza2FibGUiCiAgICB9LAogICAgewogICAgICAic3JjIjogImljb24tNTEyLnBuZyIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2UvcG5nIiwKICAgICAgInB1cnBvc2UiOiAiYW55IG1hc2thYmxlIgogICAgfQogIF0sCiAgInN0YXJ0X3VybCI6ICIvIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAib3JpZW50YXRpb24iOiAicG9ydHJhaXQiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmMWY1ZjkiLAogICJ0aGVtZV9jb2xvciI6ICIjNGY0NmU1Igp9">
    
    <!-- Theme color for browser UI -->
    <meta name="theme-color" content="#4f46e5" />
    
    <!-- iOS specific tags for PWA -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Calendar Ledger" />
    <link rel="apple-touch-icon" href="/icon-192.png" />

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Set dark mode immediately to prevent FOUC
      if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    </script>
  <script type="importmap">
{
  "imports": {
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.1.1/",
    "react/": "https://aistudiocdn.com/react@^19.1.1/",
    "react": "https://aistudiocdn.com/react@^19.1.1",
    "@google/genai": "https://esm.run/@google/genai"
  }
}
</script>
</head>
  <body class="bg-slate-100 dark:bg-slate-900">
    <div id="root"></div>
    <script type="module">
import React from 'react';
import ReactDOM from 'react-dom/client';
import { GoogleGenAI } from '@google/genai';

// --- INLINED CODE FROM ALL APP FILES ---

// From types.ts
const OperationType = {
  ADD: 'add',
  SUBTRACT: 'subtract',
};

const Priority = {
  LOW: 'low',
  MEDIUM: 'medium',
  HIGH: 'high',
};

// From components/*.tsx (Icons)
const SunIcon = (props) => React.createElement('svg',{xmlns:'http://www.w3.org/2000/svg',fill:'none',viewBox:'0 0 24 24',strokeWidth:1.5,stroke:'currentColor',...props},React.createElement('path',{strokeLinecap:'round',strokeLinejoin:'round',d:'M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z'}));
const MoonIcon = (props) => React.createElement('svg',{xmlns:'http://www.w3.org/2000/svg',fill:'none',viewBox:'0 0 24 24',strokeWidth:1.5,stroke:'currentColor',...props},React.createElement('path',{strokeLinecap:'round',strokeLinejoin:'round',d:'M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z'}));
const SparklesIcon = (props) => React.createElement('svg',{xmlns:'http://www.w3.org/2000/svg',fill:'none',viewBox:'0 0 24 24',strokeWidth:1.5,stroke:'currentColor',...props},React.createElement('path',{strokeLinecap:'round',strokeLinejoin:'round',d:'M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.684-2.684l-1.938-.648 1.938-.648a3.375 3.375 0 002.684-2.684l.648-1.938.648 1.938a3.375 3.375 0 002.684 2.684l1.938.648-1.938.648a3.375 3.375 0 00-2.684 2.684z'}));
const ChevronLeftIcon = (props) => React.createElement('svg',{xmlns:'http://www.w3.org/2000/svg',fill:'none',viewBox:'0 0 24 24',strokeWidth:1.5,stroke:'currentColor',...props},React.createElement('path',{strokeLinecap:'round',strokeLinejoin:'round',d:'M15.75 19.5L8.25 12l7.5-7.5'}));
const ChevronRightIcon = (props) => React.createElement('svg',{xmlns:'http://www.w3.org/2000/svg',fill:'none',viewBox:'0 0 24 24',strokeWidth:1.5,stroke:'currentColor',...props},React.createElement('path',{strokeLinecap:'round',strokeLinejoin:'round',d:'M8.25 4.5l7.5 7.5-7.5 7.5'}));
const PlusIcon = (props) => React.createElement('svg',{xmlns:'http://www.w3.org/2000/svg',fill:'none',viewBox:'0 0 24 24',strokeWidth:1.5,stroke:'currentColor',...props},React.createElement('path',{strokeLinecap:'round',strokeLinejoin:'round',d:'M12 4.5v15m7.5-7.5h-15'}));
const MinusIcon = (props) => React.createElement('svg',{xmlns:'http://www.w3.org/2000/svg',fill:'none',viewBox:'0 0 24 24',strokeWidth:1.5,stroke:'currentColor',...props},React.createElement('path',{strokeLinecap:'round',strokeLinejoin:'round',d:'M19.5 12h-15'}));
const TrashIcon = (props) => React.createElement('svg',{xmlns:'http://www.w3.org/2000/svg',fill:'none',viewBox:'0 0 24 24',strokeWidth:1.5,stroke:'currentColor',...props},React.createElement('path',{strokeLinecap:'round',strokeLinejoin:'round',d:'M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.033-2.134H8.033c-1.12 0-2.033.954-2.033 2.134v.916m7.5 0a48.667 48.667 0 00-7.5 0'}));


// From components/ThemeToggle.tsx
const ThemeToggle = ({ theme, onToggle }) => {
  return React.createElement('button',{onClick:onToggle,className:'p-2 rounded-full text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-slate-800 dark:hover:text-slate-100 transition-colors','aria-label':'Toggle theme'},theme === 'light' ? React.createElement(MoonIcon,{className:'h-6 w-6'}) : React.createElement(SunIcon,{className:'h-6 w-6'}));
};

// From components/FinancialSummary.tsx
const FinancialSummary = ({ monthlyEntries }) => {
    const { useState } = React;
    const [summary, setSummary] = useState('');
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState('');

    const handleGenerateSummary = async () => {
        if (monthlyEntries.length === 0) {
            setError("No entries to summarize for this month.");
            return;
        }

        setLoading(true);
        setSummary('');
        setError('');

        try {
            // IMPORTANT: Replace "YOUR_API_KEY_HERE" with your actual Google Gemini API key.
            const apiKey = "YOUR_API_KEY_HERE";
            if (apiKey === "YOUR_API_KEY_HERE") {
              setError("Please replace 'YOUR_API_KEY_HERE' in the index.html file with your Gemini API key.");
              setLoading(false);
              return;
            }
            const ai = new GoogleGenAI({ apiKey });
            
            const prompt = `You are a helpful financial assistant. Analyze the following financial entries for the month and provide a concise, insightful summary. Focus on spending habits, income, and the overall financial picture. Keep the summary to 2-3 short paragraphs. Use a friendly and encouraging tone. Here are the entries:\n${monthlyEntries.map(day => `Date: ${day.date}\nEntries:\n${day.entries.map(entry => `- ${entry.type === OperationType.ADD ? 'Income' : 'Expense'} (${entry.priority || Priority.MEDIUM} priority): ${entry.value.toFixed(2)}`).join('\n')}`).join('\n')}`;

            const response = await ai.models.generateContent({
                model: 'gemini-2.5-flash',
                contents: prompt,
            });
            
            setSummary(response.text);

        } catch (e) {
            console.error(e);
            setError('Failed to generate summary. Please check your API key and network connection, then try again.');
        } finally {
            setLoading(false);
        }
    };
    
    const hasEntries = monthlyEntries.length > 0;

    return React.createElement('div', { className: 'mt-6 pt-6 border-t border-slate-200 dark:border-slate-700' },
        React.createElement('h3', { className: 'text-lg font-semibold text-slate-800 dark:text-slate-100 mb-4' }, 'AI Financial Summary'),
        React.createElement('button', { onClick: handleGenerateSummary, disabled: loading || !hasEntries, className: 'w-full flex justify-center items-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 disabled:bg-purple-400 disabled:cursor-not-allowed transition-colors', 'aria-label': 'Generate financial summary' },
            loading ? React.createElement(React.Fragment, null, React.createElement('svg', { className: 'animate-spin -ml-1 mr-3 h-5 w-5 text-white', xmlns: 'http://www.w3.org/2000/svg', fill: 'none', viewBox: '0 0 24 24' }, React.createElement('circle', { className: 'opacity-25', cx: '12', cy: '12', r: '10', stroke: 'currentColor', strokeWidth: '4' }), React.createElement('path', { className: 'opacity-75', fill: 'currentColor', d: 'M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z' })), 'Generating...') : React.createElement(React.Fragment, null, React.createElement(SparklesIcon, { className: 'h-5 w-5 mr-2' }), 'Generate Summary')
        ),
        !hasEntries && React.createElement('p', { className: 'text-sm text-slate-500 dark:text-slate-400 mt-2 text-center' }, 'No entries this month to summarize.'),
        error && React.createElement('p', { className: 'mt-4 text-sm text-red-600 dark:text-red-400' }, error),
        summary && React.createElement('div', { className: 'mt-4 p-4 bg-slate-100 dark:bg-slate-800 rounded-lg' }, React.createElement('p', { className: 'text-slate-700 dark:text-slate-300 whitespace-pre-wrap' }, summary))
    );
};

// From components/MonthlyTotal.tsx
const MonthlyTotal = ({ total }) => {
  const totalColor = total >= 0 ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400';
  return React.createElement('div',{className:'mt-6 pt-6 border-t border-slate-200 dark:border-slate-700'},React.createElement('div',{className:'flex justify-between items-baseline'},React.createElement('h3',{className:'text-lg font-semibold text-slate-800 dark:text-slate-100'},'Monthly Total:'),React.createElement('p',{className:`text-2xl font-bold ${totalColor}`},total.toLocaleString(undefined,{style:'decimal',minimumFractionDigits:2,maximumFractionDigits:2}))));
};

// From components/Header.tsx
const Header = ({ currentDate, onPrevMonth, onNextMonth, theme, onThemeChange }) => {
  const monthName = currentDate.toLocaleString('default',{month:'long'});
  const year = currentDate.getFullYear();
  return React.createElement('header',{className:'bg-white dark:bg-slate-800 p-4 sm:p-6 border-b border-slate-200 dark:border-slate-700 flex flex-wrap items-center justify-between gap-y-4'},React.createElement('div',{className:'flex items-center space-x-2'},React.createElement('svg',{xmlns:'http://www.w3.org/2000/svg',className:'h-8 w-8 text-indigo-600',fill:'none',viewBox:'0 0 24 24',stroke:'currentColor',strokeWidth:2},React.createElement('path',{strokeLinecap:'round',strokeLinejoin:'round',d:'M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'})),React.createElement('h1',{className:'text-xl sm:text-2xl font-bold text-slate-900 dark:text-slate-100'},'Calendar Ledger')),React.createElement('div',{className:'flex items-center space-x-2 sm:space-x-4'},React.createElement(ThemeToggle,{theme:theme,onToggle:onThemeChange}),React.createElement('h2',{className:'text-lg sm:text-xl font-semibold text-slate-700 dark:text-slate-300 min-w-[8rem] text-center'},`${monthName} ${year}`),React.createElement('div',{className:'flex items-center space-x-1'},React.createElement('button',{onClick:onPrevMonth,className:'p-2 rounded-full text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-slate-800 dark:hover:text-slate-100 transition-colors','aria-label':'Previous month'},React.createElement(ChevronLeftIcon,{className:'h-6 w-6'})),React.createElement('button',{onClick:onNextMonth,className:'p-2 rounded-full text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-slate-800 dark:hover:text-slate-100 transition-colors','aria-label':'Next month'},React.createElement(ChevronRightIcon,{className:'h-6 w-6'})))));
};

// From components/DayDetail.tsx
const DayDetail = ({ selectedDate, entries, onAddEntry, onDeleteEntry }) => {
    const { useState } = React;
    const [inputValue, setInputValue] = useState('');
    const [operation, setOperation] = useState(OperationType.ADD);
    const [priority, setPriority] = useState(Priority.MEDIUM);

    const handleAdd = (e) => {
        e.preventDefault();
        const value = parseFloat(inputValue);
        if (!isNaN(value) && value !== 0) {
            onAddEntry(value, operation, priority);
            setInputValue('');
            setPriority(Priority.MEDIUM);
        }
    };

    const dayOfWeek = selectedDate.toLocaleString('default',{weekday:'long'});
    const day = selectedDate.getDate();
    const month = selectedDate.toLocaleString('default',{month:'long'});
    const year = selectedDate.getFullYear();
    
    const priorityStyles = {
        [Priority.HIGH]: 'bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300',
        [Priority.MEDIUM]: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300',
        [Priority.LOW]: 'bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300'
    };
    
    const priorityButtonBaseClasses = 'w-full text-center px-3 py-2 border text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-slate-800';
    const priorityButtonActiveClasses = 'bg-indigo-600 text-white border-indigo-600';
    const priorityButtonInactiveClasses = 'bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-600';

    return React.createElement('div',{className:'flex flex-col h-full'},React.createElement('div',{className:'mb-6'},React.createElement('p',{className:'text-lg font-semibold text-slate-800 dark:text-slate-100'},dayOfWeek),React.createElement('p',{className:'text-3xl font-bold text-indigo-600 dark:text-indigo-400'},`${day} ${month} ${year}`)),React.createElement('form',{onSubmit:handleAdd,className:'mb-6'},React.createElement('label',{htmlFor:'entry-value',className:'block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1'},'New Entry'),React.createElement('div',{className:'flex space-x-2'},React.createElement('input',{id:'entry-value',type:'number',step:'0.01',value:inputValue,onChange:(e) => setInputValue(e.target.value),placeholder:'Enter amount',className:'flex-grow w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-200 placeholder-slate-400 dark:placeholder-slate-400'}),React.createElement('div',{className:'flex rounded-md shadow-sm'},React.createElement('button',{type:'button',onClick:() => setOperation(OperationType.ADD),className:`px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-l-md transition-colors ${operation === OperationType.ADD ? 'bg-green-500 text-white border-green-500' : 'bg-white dark:bg-slate-700 hover:bg-slate-50 dark:hover:bg-slate-600'}`},React.createElement(PlusIcon,{className:'h-5 w-5'})),React.createElement('button',{type:'button',onClick:() => setOperation(OperationType.SUBTRACT),className:`px-3 py-2 border-t border-b border-r border-slate-300 dark:border-slate-600 rounded-r-md transition-colors ${operation === OperationType.SUBTRACT ? 'bg-red-500 text-white border-red-500' : 'bg-white dark:bg-slate-700 hover:bg-slate-50 dark:hover:bg-slate-600'}`},React.createElement(MinusIcon,{className:'h-5 w-5'})))),React.createElement('div', { className: 'mt-3' }, React.createElement('label', { className: 'block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1' }, 'Priority'), React.createElement('div', { className: 'grid grid-cols-3 gap-1' }, React.createElement('button', { type: 'button', onClick: () => setPriority(Priority.LOW), className: `${priorityButtonBaseClasses} rounded-l-md ${priority === Priority.LOW ? priorityButtonActiveClasses : priorityButtonInactiveClasses}` }, 'Low'), React.createElement('button', { type: 'button', onClick: () => setPriority(Priority.MEDIUM), className: `${priorityButtonBaseClasses} ${priority === Priority.MEDIUM ? priorityButtonActiveClasses : priorityButtonInactiveClasses}` }, 'Medium'), React.createElement('button', { type: 'button', onClick: () => setPriority(Priority.HIGH), className: `${priorityButtonBaseClasses} rounded-r-md ${priority === Priority.HIGH ? priorityButtonActiveClasses : priorityButtonInactiveClasses}` }, 'High'))),React.createElement('button',{type:'submit',className:'mt-4 w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500'},'Add Entry')),React.createElement('div',{className:'flex-grow overflow-y-auto'},React.createElement('h3',{className:'text-md font-semibold text-slate-800 dark:text-slate-100 mb-2 border-b dark:border-slate-700 pb-2'},'Entries for this day'),entries.length === 0 ? React.createElement('p',{className:'text-slate-500 dark:text-slate-400 text-sm mt-4 text-center'},'No entries yet.') : React.createElement('ul',{className:'space-y-2'},entries.map(entry => React.createElement('li',{key:entry.id,className:'flex items-center justify-between bg-white/50 dark:bg-slate-700/50 p-2.5 rounded-md shadow-sm'},React.createElement('div',{className:'flex items-center'},entry.type === OperationType.ADD ? React.createElement(PlusIcon,{className:'h-5 w-5 text-green-500 dark:text-green-400 mr-3'}) : React.createElement(MinusIcon,{className:'h-5 w-5 text-red-500 dark:text-red-400 mr-3'}),React.createElement('span',{className:`font-medium ${entry.type === OperationType.ADD ? 'text-green-700 dark:text-green-300' : 'text-red-700 dark:text-red-300'}`},entry.value.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}))),React.createElement('div', { className: 'flex items-center space-x-3' }, React.createElement('span', { className: `px-2 inline-flex text-xs leading-5 font-semibold rounded-full capitalize ${priorityStyles[entry.priority || Priority.MEDIUM]}` }, entry.priority || Priority.MEDIUM),React.createElement('button',{onClick:() => onDeleteEntry(entry.id),className:'p-1 rounded-full text-slate-400 dark:text-slate-500 hover:bg-red-100 dark:hover:bg-red-900/50 hover:text-red-600 dark:hover:text-red-400 transition-colors'},React.createElement(TrashIcon,{className:'h-5 w-5'}))))))));
};

const formatDateKey = (date) => date.toISOString().split('T')[0];

// From components/Calendar.tsx
const Calendar = ({ currentDate, selectedDate, onDateSelect, entries }) => {
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    const firstDayOfMonth = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const daysOfWeek = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

    const renderDays = () => {
        const days = [];
        const today = new Date();
        for (let i = 0; i < firstDayOfMonth; i++) {
            days.push(React.createElement('div',{key:`blank-${i}`,className:'border-r border-b border-slate-200 dark:border-slate-700'}));
        }
        for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(year, month, day);
            const dateKey = formatDateKey(date);
            const isToday = date.toDateString() === today.toDateString();
            const isSelected = date.toDateString() === selectedDate.toDateString();
            const hasEntries = entries[dateKey] && entries[dateKey].length > 0;
            let cellClasses = "relative p-2 border-r border-b border-slate-200 dark:border-slate-700 text-sm cursor-pointer transition-colors duration-200 ";
            let dayNumberClasses = "flex items-center justify-center h-8 w-8 rounded-full transition-colors duration-200 ";
            if (isSelected) {
                cellClasses += "bg-indigo-100 dark:bg-indigo-900/50 ";
                dayNumberClasses += "bg-indigo-600 text-white font-bold ";
            } else if (isToday) {
                dayNumberClasses += "bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-100 font-semibold ";
                cellClasses += "hover:bg-slate-100 dark:hover:bg-slate-700/50 ";
            } else {
                dayNumberClasses += "text-slate-700 dark:text-slate-300 ";
                cellClasses += "hover:bg-slate-100 dark:hover:bg-slate-700/50 ";
            }
            days.push(React.createElement('div',{key:day,className:cellClasses,onClick:() => onDateSelect(date)},React.createElement('div',{className:dayNumberClasses},day),hasEntries && React.createElement('div',{className:'absolute bottom-1 right-1 h-2 w-2 bg-green-500 rounded-full'})));
        }
        return days;
    };

    return React.createElement('div',null,React.createElement('div',{className:'grid grid-cols-7 text-center font-semibold text-slate-600 dark:text-slate-400 text-xs'},daysOfWeek.map(day => React.createElement('div',{key:day,className:'py-2 border-b-2 border-slate-200 dark:border-slate-700'},day))),React.createElement('div',{className:'grid grid-cols-7',style:{minHeight:'360px'}},renderDays()));
};

// From App.tsx
const App = () => {
  const { useState, useEffect, useMemo, useCallback } = React;
  const [currentDate, setCurrentDate] = useState(new Date());
  const [selectedDate, setSelectedDate] = useState(new Date());
  const [entries, setEntries] = useState({});
  const [theme, setTheme] = useState(() => {
     if (typeof window !== 'undefined' && window.localStorage) {
      const storedTheme = window.localStorage.getItem('theme');
      if (storedTheme) return storedTheme;
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) return 'dark';
    }
    return 'light';
  });

  useEffect(() => {
    try {
      const storedEntries = localStorage.getItem('calendarLedgerEntries');
      if (storedEntries) setEntries(JSON.parse(storedEntries));
    } catch (error) {
      console.error("Failed to load entries from localStorage", error);
    }
  }, []);

  useEffect(() => {
    try {
      localStorage.setItem('calendarLedgerEntries', JSON.stringify(entries));
    } catch (error) {
      console.error("Failed to save entries to localStorage", error);
    }
  }, [entries]);

  useEffect(() => {
    const root = window.document.documentElement;
    if (theme === 'dark') root.classList.add('dark');
    else root.classList.remove('dark');
    localStorage.setItem('theme', theme);
  }, [theme]);

  const handleThemeChange = useCallback(() => setTheme(prev => prev === 'light' ? 'dark' : 'light'), []);
  const handlePrevMonth = useCallback(() => setCurrentDate(prev => new Date(prev.getFullYear(), prev.getMonth() - 1, 1)), []);
  const handleNextMonth = useCallback(() => setCurrentDate(prev => new Date(prev.getFullYear(), prev.getMonth() + 1, 1)), []);
  const handleDateSelect = useCallback((day) => setSelectedDate(day), []);

  const handleAddEntry = useCallback((value, type, priority) => {
    const dateKey = formatDateKey(selectedDate);
    const newEntry = { id: crypto.randomUUID(), value, type, priority };
    setEntries(prev => ({ ...prev, [dateKey]: [...(prev[dateKey] || []), newEntry] }));
  }, [selectedDate]);

  const handleDeleteEntry = useCallback((id) => {
    const dateKey = formatDateKey(selectedDate);
    setEntries(prev => {
      const updatedEntries = (prev[dateKey] || []).filter(entry => entry.id !== id);
      const newEntriesForDate = { ...prev };
      if (updatedEntries.length > 0) newEntriesForDate[dateKey] = updatedEntries;
      else delete newEntriesForDate[dateKey];
      return newEntriesForDate;
    });
  }, [selectedDate]);

  const monthlyTotal = useMemo(() => {
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    return Object.keys(entries).reduce((total, dateKey) => {
      const entryDate = new Date(dateKey);
      if (entryDate.getFullYear() === year && entryDate.getMonth() === month) {
        return entries[dateKey].reduce((dayTotal, entry) => entry.type === OperationType.ADD ? dayTotal + entry.value : dayTotal - entry.value, total);
      }
      return total;
    }, 0);
  }, [entries, currentDate]);
  
  const monthlyEntries = useMemo(() => {
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    return Object.keys(entries).filter(dateKey => {
      const entryDate = new Date(dateKey);
      return entryDate.getFullYear() === year && entryDate.getMonth() === month;
    }).sort().map(dateKey => ({ date: dateKey, entries: entries[dateKey] }));
  }, [entries, currentDate]);

  const selectedDayEntries = entries[formatDateKey(selectedDate)] || [];

  return React.createElement('div',{className:'min-h-screen font-sans text-slate-800 dark:text-slate-200 p-4 sm:p-6 lg:p-8'},React.createElement('div',{className:'max-w-7xl mx-auto bg-white dark:bg-slate-800 rounded-2xl shadow-xl overflow-hidden'},React.createElement(Header,{currentDate:currentDate,onPrevMonth:handlePrevMonth,onNextMonth:handleNextMonth,theme:theme,onThemeChange:handleThemeChange}),React.createElement('div',{className:'flex flex-col md:flex-row'},React.createElement('div',{className:'w-full md:w-3/5 lg:w-2/3 p-6 border-b md:border-b-0 md:border-r border-slate-200 dark:border-slate-700'},React.createElement(Calendar,{currentDate:currentDate,selectedDate:selectedDate,onDateSelect:handleDateSelect,entries:entries})),React.createElement('div',{className:'w-full md:w-2/5 lg:w-1/3 p-6 bg-slate-50 dark:bg-slate-900/50 flex flex-col'},React.createElement('div',{className:'flex-grow'},React.createElement(DayDetail,{selectedDate:selectedDate,entries:selectedDayEntries,onAddEntry:handleAddEntry,onDeleteEntry:handleDeleteEntry})),React.createElement(MonthlyTotal,{total:monthlyTotal}),React.createElement(FinancialSummary,{monthlyEntries:monthlyEntries})))),React.createElement('footer',{className:'text-center text-sm text-slate-500 dark:text-slate-400 mt-8'},React.createElement('p',null,'Built by a world-class senior frontend React engineer.')));
};

// --- START OF SERVICE WORKER REGISTRATION ---
const swContent = `
const CACHE_NAME = 'calendar-ledger-cache-v1';
const urlsToCache = ['/']; // Cache the root file itself for offline use.

self.addEventListener('install', (event) => {
  console.log('Service Worker: Installing...');
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then((cache) => {
        console.log('Service Worker: Caching app shell');
        // Since this is a standalone file, we fetch the request that triggered the SW install.
        return fetch(event.request).then(response => {
           return cache.put('/', response);
        });
      })
      .catch(error => console.error('Failed to cache app shell:', error))
  );
});

self.addEventListener('fetch', (event) => {
  if (event.request.method !== 'GET') return;
  event.respondWith(
    caches.match(event.request)
      .then((response) => {
        if (response) return response;
        return fetch(event.request).catch(() => {
            // This is a basic offline fallback.
            // In a single-file app, if the root isn't cached, this may not be very useful.
        });
      })
  );
});

self.addEventListener('activate', (event) => {
  console.log('Service Worker: Activating...');
  const cacheWhitelist = [CACHE_NAME];
  event.waitUntil(
    caches.keys().then((cacheNames) => {
      return Promise.all(
        cacheNames.map((cacheName) => {
          if (cacheWhitelist.indexOf(cacheName) === -1) {
            console.log('Service Worker: Deleting old cache', cacheName);
            return caches.delete(cacheName);
          }
        })
      );
    })
  );
});
`;

if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    const blob = new Blob([swContent], { type: 'application/javascript' });
    const swUrl = URL.createObjectURL(blob);
    navigator.serviceWorker.register(swUrl)
      .then(registration => console.log('SW registered: ', registration))
      .catch(registrationError => console.log('SW registration failed: ', registrationError));
  });
}
// --- END OF SERVICE WORKER REGISTRATION ---

// From index.tsx (Mounting logic)
const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}
const root = ReactDOM.createRoot(rootElement);
root.render(React.createElement(React.StrictMode, null, React.createElement(App)));

    </script>
  </body>
</html>